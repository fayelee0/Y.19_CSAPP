#+TITLE: Practice 40

#+BEGIN_SRC c

#define N 16

typedef int fix_matrix[N][N]

/* set all diagonal elements to val */
void fix_set_diag(fix_matrix A, int val)
{
    for (long i = 0; i < N; i++) {
        A[i][i] = val;
    }
}

#+END_SRC

#+BEGIN_SRC asm

fix_set_diag:
  movl    $0, %eax
.L13:
  movl    %esi, (%rdi, %rax)
  addq    $68, %rax
  cmpq    $1088, %rax
  jne     .L13
  rep; ret

#+END_SRC


#+BEGIN_SRC c

void fix_set_diag(fix_matrix A, int val)
{
    int* Aptr = &A[0][0];
    long i = 0;
    long done = N * (N + 1);
    do {
        Aptr[i] = val;
        i += (N + 1);
    } while (i != done);
}

#+END_SRC
