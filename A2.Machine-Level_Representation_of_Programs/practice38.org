#+TITLE: Practice 38

#+BEGIN_SRC c

long P[M][N];
long Q[N][M];

long sum_element(long i, long j)
{
    return P[i][j] + Q[j][i];
}

#+END_SRC


#+BEGIN_SRC asm

.long sum_element(long i, long j)
.i in %rdi, j in %rsi
sum_element:
  leaq   0(,%rdi,8), %rdx            ; 8i         
  subq   %rdi, %rdx                  ; 7i
  addq   %rsi, %rdx                  ; 7i+j       ; %rdx
  leaq   (%rsi,%rsi,4), %rax         ; 5j
  addq   %rax, %rdi                  ; 5j+i       ; %rdi
  movq   Q(,%rdi,8), %rax            ; 8(7i+j) = M[X_Q + 8 * (5j + i)]  ; M = 5
  addq   P(,%rdx,8), %rax            ; 8(5j+i) = M[X_P + 8 * (7i + j)]  ; N = 7
  ret

#+END_SRC

_A[i][j] = M[X_A + L * (i * COLUMN_SIZE + j)]_

#define M 5
#define N 7
