#+AUTHOR: Fei Li
#+EMAIL: wizard@pursuetao.com
* Practice 20

  #+BEGIN_SRC c
  
  #define OP ...
  
  long arith(long x) 
  {
      return x OP 8;
  }
  
  #+END_SRC


  #+BEGIN_SRC asm

  ; long arith(long x)
  ; x in %rdi
  arith:
    leaq   7(%rdi),%rax         ; t = 7 + x
    testq  %rdi,%rdi            ; x:x
    cmovns %rdi,%rax            ; if (x >= 0) t = x
    sarq   $3,%rax              ; x >> 3, x / 8
    ret
  
  #+END_SRC


  #+BEGIN_SRC c

  long arith(long x)
  {
      return x / 8;
  }
  
  #+END_SRC
