#+AUTHOR: Fei Li
#+EMAIL: wizard@pursuetao.com
* Practice 38

  #+BEGIN_SRC c

  #define M ...
  #define N ...

  long P[M][N];
  long Q[N][M];

  long sum_element(long i, long j)
  {
      return P[i][j] + Q[j][i];
  }
  
  #+END_SRC

  
  #+BEGIN_SRC asm

  ; long sum_element(long i, long j)
  ; i in %rdi, j in %rsi
  sum_element:
    leaq 0(,%rdi,8), %rdx             ; t = 8i
    subq %rdi, %rdx                   ; t = t - i = 7i
    addq %rsi, %rdx                   ; rdx = t + j = 7i + j
    leaq (%rsi,%rsi,4), %rax          ; 5j
    addq %rax, %rdi                   ; rdi = i + 5j
    movq Q(,%rdi,8), %rax             ; Q(,%rdi,8) ~ 8 * %rdi ~ 8 * (5j + i) ==> M = 5
    addq P(,%rdx,8), %rax             ; P(,%rdi,8) ~ 8 * %rdx ~ 8 * (7i + j) ==> N = 7
    ret
  
  #+END_SRC

  
  P[M][N] ==> P[i][j] = Xp + i * N * 8 + 8 * j = Xp + 8 * (i * N + j)
  Q[N][M] ==> Q[j][i] = Xq + j * M * 8 + 8 * i = Xq + 8 * (j * M + i)


  ==> M = 5, N = 7
