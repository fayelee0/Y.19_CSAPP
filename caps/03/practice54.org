#+AUTHOR: Fei Li
#+EMAIL: wizard@pursuetao.com
* Practice 54

  #+BEGIN_SRC c

  double funct2(double w, int x, float y, long z);
  
  #+END_SRC


  #+BEGIN_SRC asm
  
  ; double funct2(double w, int x, float y, long z)
  ; w in %xmm0, x in %edi, y in %xmm1, z in %rsi
  funct2:
    vcvtsi2ss   %edi, %xmm2, %xmm2      ; x -> float => %xmm2
    vmulss      %xmm1, %xmm2, %xmm1     ; x * y      => %xmm1
    vunpcklps   %xmm1, %xmm1, %xmm1     ; %xmm1 -> double
    vcvtps2pd   %xmm1, %xmm2            ; %xmm2 -> 
    vcvtsi2sdq  %rsi, %xmm1, %xmm1      ; z -> double => %xmm1
    vdivsd      %xmm1, %xmm0, %xmm0     ; w / %xmm1   => %xmm0
    vsubsd      %xmm0, %xmm2, %xmm0     ; %xmm2 - %xmm0
    ret
  
  #+END_SRC


  #+BEGIN_SRC c

  double funct2(double w, int x, float y, long z)
  {
      /*
      float t = (float) x * y;
      return t - w / z;
      */

      return x * y - w / z;
  }
  
  #+END_SRC
