#+AUTHOR: Fei Li
#+EMAIL: wizard@pursuetao.com
* Practice 40

  #+BEGIN_SRC c
  
  #define N 16
  
  typedef int fix_matrix[N][N];

  /* Set all diagonal elements to val */
  void fix_set_diag(fix_matrix A, int val)
  {
      for (long i = 0; i < N; i++) {
          A[i][i] = val;
      }
  }

  
  #+END_SRC


  #+BEGIN_SRC asm

  ; void fix_set_diag(fix_matrix A, int val)
  ; A in %rdi, val in %rsi
    movl $0, %eax
  .L13:
    movl %esi, (%rdi,%rax)
    addq $68, %rax
    cmpq $1088, %rax
    jne  .L13
    rep; ret
  
  #+END_SRC


  #+BEGIN_SRC c

  void fix_set_diag_opt(fix_matrix A, int val)
  {
      int* Aptr = &A[0][0];
      int* Aend = &A[N][N];

      do {
          *Aptr = val;
          Aptr += 4 * (N + 1);
      } while (Aptr != Aend);
  }
  
  #+END_SRC
